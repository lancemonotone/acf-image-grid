# ACF Image Grid – Developer Guide (Conformed)

This document describes how this specific plugin (`acf-image-grid`) is structured and how it integrates with the shared MU scaffold. It replaces generic examples with the files that actually exist in this repository and clearly marks optional items that are not present.

What you CAN change in this plugin:

- Block namespaces and classes in `blocks/*/class.block.php`
- Config values in `config.php`
- Block templates and assets under `blocks/*`

## Table of Contents

1. MU Scaffold
2. Plugin Structure
3. Core Files
4. Block System
5. Asset Management
6. Field Management
7. Optional Files Not Present
8. Best Practices
9. Troubleshooting

## MU Scaffold

Core classes under the `MonotoneAcfBlockScaffold` namespace are provided by a shared MU‑plugin in `wp-content/mu-plugins`. This plugin does not copy those classes. The main plugin file defines `PLUGIN_*` constants from `config.php` and calls `monotone_acf_scaffold_boot()` which initializes the scaffold for this plugin context.

## Plugin Structure

```
acf-image-grid/
├── blocks/
│   └── acf-image-grid/
│       ├── assets/
│       │   ├── css/
│       │   │   ├── editor.css
│       │   │   ├── editor.min.css (generated)
│       │   │   ├── style.css
│       │   │   └── style.min.css (generated)
│       │   ├── images/
│       │   │   └── tribe-loading.gif
│       │   └── js/
│       │       ├── script.js
│       │       └── script.min.js (generated)
│       ├── block.json
│       ├── class.block.php
│       ├── fields.json
│       ├── README.md
│       ├── DEVELOPMENT_PLAN.md (optional/project‑specific)
│       └── template.php
├── ACF_Block_Plugin_Developer_Guide.md (this file)
├── README.md (plugin description and usage)
├── .gitignore
├── acf-image-grid.php
└── config.php
```

Notes:

- The image asset folder is `assets/images/` (not `img/`).
- There is one block in this plugin: `acf-image-grid`.
- `template-editor.php` is not present and is not used by this block.

## Core Files

### Main Plugin File (`acf-image-grid.php`)

- Defines `PLUGIN_CONFIG`, `PLUGIN_SLUG`, `PLUGIN_TEXT_DOMAIN`, `PLUGIN_BASE_PATH`, and `PLUGIN_BASE_URL` from `config.php`.
- Boots the scaffold via `monotone_acf_scaffold_boot()`.

### Configuration File (`config.php`)

Key values used by this plugin:

```php
return [
    'name' => 'ACF Image Grid',
    'slug' => 'acf-image-grid',
    'namespace' => 'ACFImageGrid',
    'text_domain' => 'acf-image-grid',
    'version' => '1.0.0',
    'author' => 'Rus Miller',
    'description' => 'Advanced Custom Fields Image Grid blocks for WordPress',
    'block_category' => [
        'slug' => 'acf-image-grid',
        'title' => 'ACF Image Grid',
        'icon' => 'format-gallery'
    ],
    'post_types' => [],
    'debug' => false,
    'assets' => [ 'minify' => true ]
];
```

## Block System

### Block Directory (Actual)

```
blocks/acf-image-grid/
├── assets/ (css, js, images)
├── block.json
├── class.block.php
├── fields.json
└── template.php
```

### `block.json`

This block uses the scaffold renderer and does not use a separate editor template:

```json
{
  "acf": {
    "mode": "auto",
    "renderCallback": "MonotoneAcfBlockScaffold\\Block_Renderer::render_block",
    "useEditorTemplate": false
  },
  "textdomain": "acf-image-grid"
}
```

### `class.block.php`

The block registers itself using the block folder path:

```php
<?php

namespace Monotone\Blocks\ACFImageGrid;

class ACF_Image_Grid {
    public function __construct() {
        add_action('init', [$this, 'register_block']);
    }

    public function register_block() {
        register_block_type(__DIR__);
    }
}
```

### `template.php`

Rendered by the scaffold via `Block_Renderer::render_block`. This plugin does not include a `template-editor.php` and sets `useEditorTemplate` to `false`.

### `fields.json`

ACF field group for this block is bundled as JSON in the block folder.

## Asset Management

- Source assets live in `assets/css` and `assets/js`.
- Minified files (`*.min.css`, `*.min.js`) are present and/or generated by the scaffold’s asset handler.
- Behavior is controlled by `config.php`:
  - Set `'debug' => true` to prefer source files.
  - Set `'assets' => ['minify' => true]` to force minified output even in debug scenarios.

## Field Management

- Requires ACF Pro.
- The bundled `fields.json` is loaded/used by the scaffold’s field group loader.

## Optional Files Not Present

These are supported by the scaffold but not included in this block:

- `template-editor.php` (set `acf.useEditorTemplate` to `true` in `block.json` if you add it)
- `assets/js/editor.js` (editor‑only behavior)
- `assets/css/admin.css`, `assets/css/global.css` (add as needed)
- `template-parts/` (not used here)

## Best Practices

- Escape output (`esc_attr`, `esc_html`) and sanitize input.
- Keep namespaces consistent; only change block‑specific code in the block folder.
- Load assets conditionally (handled by scaffold) and ship only what the block needs.
- Maintain concise `README.md` files per block.

## Troubleshooting

Common checks:

- Block not visible: verify `block.json` and that `class.block.php` runs on `init`.
- Assets not loading: confirm file paths and debug/minify flags in `config.php`.
- ACF fields missing: ensure ACF Pro is active and `fields.json` is present.

Debug/minify controls (this plugin):

- Use `config.php` flags (`'debug'`, `'assets.minify'`) instead of editing scaffold classes.

Testing checklist:

- [ ] Plugin activates without errors
- [ ] Block appears in editor
- [ ] Fields load and save
- [ ] Frontend renders as expected
- [ ] No console/PHP errors
